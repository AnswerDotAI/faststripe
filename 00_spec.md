

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

``` python
stripe_openapi_url = 'https://raw.githubusercontent.com/stripe/openapi/refs/heads/master/openapi/spec3.json'
stripe_spec = urlsend(stripe_openapi_url, 'GET', return_json=True)
stripe_spec.keys()
```

    dict_keys(['components', 'info', 'openapi', 'paths', 'security', 'servers'])

The OpenAPI spec describes how a particular REST API works. The most
important part of this spec is the paths that are defined by a
particular spec. This defines what you can do with a particular API and
usually includes things like the description of endpoint, expected
parameters, the description of the parameters, and a schema of what will
be returned from a particular endpoint.

``` python
path, verbs = first(stripe_spec['paths'].items())
path, verbs.keys()
```

    ('/v1/account', dict_keys(['get']))

``` python
verbs['get'].keys()
```

    dict_keys(['description', 'operationId', 'parameters', 'requestBody', 'responses', 'summary'])

As we can see here, the account path has a single HTTP verb that we can
use on it called GET. The verb + path is what we refer to as an
endpoint. This endpoint allows us to get the account details for a
stripe.

``` python
stripe_api_url = 'https://api.stripe.com'
ep = stripe_api_url + path
ep
```

    'https://api.stripe.com/v1/account'

``` python
stripe_key = os.environ['STRIPE_SECRET_KEY']
headers = {'Authorization': f'Bearer {stripe_key}'}
resp = urlsend(ep, 'GET', headers=headers)
resp.keys()
```

    dict_keys(['id', 'object', 'business_type', 'capabilities', 'charges_enabled', 'country', 'default_currency', 'details_submitted', 'payouts_enabled', 'settings', 'type'])

Some of these endpoints will take parameters if they are GET verbs or
request bodies. POST verbs. Here is an example for the GET customers
endpoint

``` python
path, verbs = first(stripe_spec['paths'].items(), lambda x: x[0] == '/v1/customers')
verbs['get']['parameters'][0]
```

    {'description': 'Only return customers that were created during the given date interval.',
     'explode': True,
     'in': 'query',
     'name': 'created',
     'required': False,
     'schema': {'anyOf': [{'properties': {'gt': {'type': 'integer'},
         'gte': {'type': 'integer'},
         'lt': {'type': 'integer'},
         'lte': {'type': 'integer'}},
        'title': 'range_query_specs',
        'type': 'object'},
       {'type': 'integer'}]},
     'style': 'deepObject'}

And here is one for a post

``` python
first(nested_idx(verbs, *'post requestBody content application/x-www-form-urlencoded schema properties'.split()).items())
```

    ('address',
     {'anyOf': [{'properties': {'city': {'maxLength': 5000, 'type': 'string'},
         'country': {'maxLength': 5000, 'type': 'string'},
         'line1': {'maxLength': 5000, 'type': 'string'},
         'line2': {'maxLength': 5000, 'type': 'string'},
         'postal_code': {'maxLength': 5000, 'type': 'string'},
         'state': {'maxLength': 5000, 'type': 'string'}},
        'title': 'optional_fields_customer_address',
        'type': 'object'},
       {'enum': [''], 'type': 'string'}],
      'description': "The customer's address. Learn about [country-specific requirements for calculating tax](https://docs.stripe.com/invoicing/taxes?dashboard-or-api=dashboard#set-up-customer)."})

Depending on the spec, the encoding might be json or form url encoded.
For Stripe, form url encoded is used.

Finally, parameters can be inside the path itself

``` python
path, verbs = first(stripe_spec['paths'].items(), lambda x: '{' in x[0])
path, verbs.keys()
```

    ('/v1/accounts/{account}', dict_keys(['delete', 'get', 'post']))

`fastcore` luckily has some pretty nifty helper functions to deal with
path parameters

``` python
path, *_ = partial_format(path)
route_ps = stringfmt_names(path)
route_ps
```

    ['account']

For post parameters, we can get data type information that we can
surface to developers.

``` python
_lu_type
```

    {'NA': object,
     'string': str,
     'object': dict,
     'array': list,
     'boolean': bool,
     'number': int,
     'integer': int}

``` python
d = first(_find_data(verbs['post'], 'application/x-www-form-urlencoded').items())
d
```

    ('account_token',
     {'description': 'An [account token](https://api.stripe.com#create_account_token), used to securely provide details to the account.',
      'maxLength': 5000,
      'type': 'string'})

``` python
deets = _deets(*d)
deets
```

    {'name': 'account_token',
     'description': 'An [account token](https://api.stripe.com#create_account_token), used to securely provide details to the account.',
     'annotation': str,
     'default': None}

While get requests can technically also have bodies, these are normally
ignored by HTTP servers.

The data we care most about for interfacing with an OpenAPI spec are the
data, operation id, query parameters, summary, and url. So, lets make a
helper function to grab these tidbits

``` python
info = _info(verbs['get'])
first(info['data']), info['op_id'], first(info['qparams']), info['summary']
```

    (None,
     'GetAccountsAccount',
     {'name': 'expand',
      'description': 'Specifies which fields in the response should be expanded.',
      'annotation': 'str'},
     'Retrieve account')

``` python
info = _info(verbs['post'])
first(info['data']), info['op_id'], first(info['qparams']), info['summary']
```

    ({'name': 'account_token',
      'description': 'An [account token](https://api.stripe.com#create_account_token), used to securely provide details to the account.',
      'annotation': str,
      'default': None},
     'PostAccountsAccount',
     None,
     'Update an account')

``` python
_durl(path, 'get')
```

    'https://docs.stripe.com/api/accounts/delete'

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/faststripe/blob/main/faststripe/spec.py#L73"
target="_blank" style="float:right; font-size:smaller">source</a>

### build_eps

``` python

def build_eps(
    url
):

```

*Build module metadata.py from an Open API spec and optionally filter by
a path `pre`*

``` python
eps = build_eps(stripe_openapi_url)
eps[0]
```

    {'path': '/v1/account',
     'verb': 'get',
     'data': [],
     'op_id': 'GetAccount',
     'qparams': [{'name': 'expand',
       'description': 'Specifies which fields in the response should be expanded.',
       'annotation': 'str'}],
     'summary': 'Retrieve account',
     'doc_url': 'https://docs.stripe.com/api/accounts/retrieve'}

------------------------------------------------------------------------

<a
href="https://github.com/AnswerDotAI/faststripe/blob/main/faststripe/spec.py#L82"
target="_blank" style="float:right; font-size:smaller">source</a>

### update_version

``` python

def update_version(
    
):

```

*Update the version to the latest version of the Stripe API and the
endpoints file.*

``` python
update_version()
```
